/******************************************
 * @name 草莓视频🚗
 * @channel https://t.me/yqc_123
 * @feedback https://t.me/yqc_777
 * @version 1.0.0
******************************************
1.本脚本仅用于技术学习，禁止非法使用。
2.不得将本脚本用于任何商业或违法用途，违者后果自负。
3.在中国大陆地区，严禁传播本脚本。
4.开发者不对脚本的滥用承担任何责任。
5.违规使用导致的后果由使用者自行承担。
6.如有违反相关法规，将立即删除本脚本。
7.使用者若违反声明规定，将自动视为放弃使用权。
8.本声明的最终解释权归开发者所有。
******************************************

脚本描述: 去除全局广告、解锁会员视频(不包括金币视频)
下载地址: https://gdb6kuu6m.com/?_s=93WJF

******************************************
# > 去广告/个人中心
^https?:\/\/69cmh\d+\.com\/h5\/(system/info|user\/info|movie\/block) url script-response-body https://raw.githubusercontent.com/Yuheng0101/X/main/Scripts/strawberry.js
# > 视频解锁
^https?:\/\/69cmh\d+\.com\/h5\/movie\/detail url script-analyze-echo-response https://raw.githubusercontent.com/Yuheng0101/X/main/Scripts/strawberry.js

hostname = 69cmh*.com
******************************************/
const $ = new Env('草莓视频')
var _0xodW='jsjiami.com.v7';const _0x23ca70=_0x5523;function _0x5523(_0x44e77f,_0x4e1ea2){const _0x75ab4c=_0x75ab();return _0x5523=function(_0x552329,_0x1bfed5){_0x552329=_0x552329-0x1ae;let _0x48466d=_0x75ab4c[_0x552329];if(_0x5523['ZFGHqY']===undefined){var _0x3d7c8b=function(_0x1cfa41){const _0x598365='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0xc2c4e8='',_0x167d8c='';for(let _0x70d125=0x0,_0x3ed924,_0x5c383f,_0x3d6e12=0x0;_0x5c383f=_0x1cfa41['charAt'](_0x3d6e12++);~_0x5c383f&&(_0x3ed924=_0x70d125%0x4?_0x3ed924*0x40+_0x5c383f:_0x5c383f,_0x70d125++%0x4)?_0xc2c4e8+=String['fromCharCode'](0xff&_0x3ed924>>(-0x2*_0x70d125&0x6)):0x0){_0x5c383f=_0x598365['indexOf'](_0x5c383f);}for(let _0xcef273=0x0,_0x171194=_0xc2c4e8['length'];_0xcef273<_0x171194;_0xcef273++){_0x167d8c+='%'+('00'+_0xc2c4e8['charCodeAt'](_0xcef273)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0x167d8c);};const _0x3a2cf7=function(_0x485280,_0x1068aa){let _0x49702c=[],_0x3b34bd=0x0,_0x13327c,_0x2326d4='';_0x485280=_0x3d7c8b(_0x485280);let _0x1100dd;for(_0x1100dd=0x0;_0x1100dd<0x100;_0x1100dd++){_0x49702c[_0x1100dd]=_0x1100dd;}for(_0x1100dd=0x0;_0x1100dd<0x100;_0x1100dd++){_0x3b34bd=(_0x3b34bd+_0x49702c[_0x1100dd]+_0x1068aa['charCodeAt'](_0x1100dd%_0x1068aa['length']))%0x100,_0x13327c=_0x49702c[_0x1100dd],_0x49702c[_0x1100dd]=_0x49702c[_0x3b34bd],_0x49702c[_0x3b34bd]=_0x13327c;}_0x1100dd=0x0,_0x3b34bd=0x0;for(let _0x3f6f75=0x0;_0x3f6f75<_0x485280['length'];_0x3f6f75++){_0x1100dd=(_0x1100dd+0x1)%0x100,_0x3b34bd=(_0x3b34bd+_0x49702c[_0x1100dd])%0x100,_0x13327c=_0x49702c[_0x1100dd],_0x49702c[_0x1100dd]=_0x49702c[_0x3b34bd],_0x49702c[_0x3b34bd]=_0x13327c,_0x2326d4+=String['fromCharCode'](_0x485280['charCodeAt'](_0x3f6f75)^_0x49702c[(_0x49702c[_0x1100dd]+_0x49702c[_0x3b34bd])%0x100]);}return _0x2326d4;};_0x5523['IBDune']=_0x3a2cf7,_0x44e77f=arguments,_0x5523['ZFGHqY']=!![];}const _0x11f8af=_0x75ab4c[0x0],_0x296fb8=_0x552329+_0x11f8af,_0x48aba8=_0x44e77f[_0x296fb8];return!_0x48aba8?(_0x5523['UzqiJU']===undefined&&(_0x5523['UzqiJU']=!![]),_0x48466d=_0x5523['IBDune'](_0x48466d,_0x1bfed5),_0x44e77f[_0x296fb8]=_0x48466d):_0x48466d=_0x48aba8,_0x48466d;},_0x5523(_0x44e77f,_0x4e1ea2);}(function(_0x5da48d,_0x694d,_0x426cc4,_0x215866,_0x5b3fda,_0x3165ed,_0x262394){return _0x5da48d=_0x5da48d>>0x5,_0x3165ed='hs',_0x262394='hs',function(_0x3a63d7,_0x57d216,_0x4d1487,_0x427e32,_0x35bef9){const _0x3e17a7=_0x5523;_0x427e32='tfi',_0x3165ed=_0x427e32+_0x3165ed,_0x35bef9='up',_0x262394+=_0x35bef9,_0x3165ed=_0x4d1487(_0x3165ed),_0x262394=_0x4d1487(_0x262394),_0x4d1487=0x0;const _0x43684e=_0x3a63d7();while(!![]&&--_0x215866+_0x57d216){try{_0x427e32=-parseInt(_0x3e17a7(0x1e5,'DhUx'))/0x1+-parseInt(_0x3e17a7(0x1bd,'yZRW'))/0x2+parseInt(_0x3e17a7(0x1e8,'fE)C'))/0x3+-parseInt(_0x3e17a7(0x207,'&DB)'))/0x4+parseInt(_0x3e17a7(0x1ae,'u@1a'))/0x5+parseInt(_0x3e17a7(0x1fb,'w&tE'))/0x6+parseInt(_0x3e17a7(0x1d3,'9gOY'))/0x7;}catch(_0x268d7c){_0x427e32=_0x4d1487;}finally{_0x35bef9=_0x43684e[_0x3165ed]();if(_0x5da48d<=_0x215866)_0x4d1487?_0x5b3fda?_0x427e32=_0x35bef9:_0x5b3fda=_0x35bef9:_0x4d1487=_0x35bef9;else{if(_0x4d1487==_0x5b3fda['replace'](/[kdGQhbPIqVlguBJANxY=]/g,'')){if(_0x427e32===_0x57d216){_0x43684e['un'+_0x3165ed](_0x35bef9);break;}_0x43684e[_0x262394](_0x35bef9);}}}}}(_0x426cc4,_0x694d,function(_0x206c7d,_0x49bec9,_0x2324d8,_0x1e906c,_0x4b96e4,_0x5bd55a,_0x22c642){return _0x49bec9='\x73\x70\x6c\x69\x74',_0x206c7d=arguments[0x0],_0x206c7d=_0x206c7d[_0x49bec9](''),_0x2324d8='\x72\x65\x76\x65\x72\x73\x65',_0x206c7d=_0x206c7d[_0x2324d8]('\x76'),_0x1e906c='\x6a\x6f\x69\x6e',(0x1600ce,_0x206c7d[_0x1e906c](''));});}(0x1920,0xe9bd0,_0x75ab,0xcb),_0x75ab)&&(_0xodW=`\xea3`);$[_0x23ca70(0x203,'zcsL')]=typeof $request!==_0x23ca70(0x1b3,'tK]G')&&$request['body'],$[_0x23ca70(0x1d4,'Hrot')]={'body':$[_0x23ca70(0x203,'zcsL')]?'{}':$response['body']};function _0x75ab(){const _0xb4f65f=(function(){return[_0xodW,'lJjxskYjiaGmPkiQb.AhcuJVoIBm.Pdgvq7NbhJB==','WQiPDg8','imoEW4hcVN5IW73dKfr9jKhdVW','W4JcPeNdSG','ymkTEeG','uSkQWR7dGMNcJa','W5aZW5y','EcNdUvKVFSkGWO7dL0rHWRZdGgtdJeJdGsrGWPqEWPTg','y8kiWOhdTIi7WRZdKW','W4ddQ8kwW4u','rSkBW40LW67cO8ksWPy','6l2I6kAa5l6M55w+5A2b6iAQ55QH5zgQ5P6G55wH5l+t55w76ioe6iEo6kkK5OIR5OI744g2','WPpcT8obWOtdHq7dUCkthbNcLflcVa','W7DTW6W8WQ4Og0pdV8kVuCkvW7GaeSkLW5e','W48LW4jYxSkdWR7cPa','WR80ELZcTCofWR8XWRVcJHerBW','vCkrW7uhW7BcQmkuWR3dICkWW5e','WP44mW8bW6xdSJyMbYzvhtK','u8kTWRPCj8kmlmoz','WR/cISoiWPjHrmoR','W5lcQfrDWO5iW70','WOKUdCog','D8oqW48f','mxZdKmkooaD+kSot','W40HWQOMW5iWvGe','5z2v5lMS5zIj5Awg6zIU5zYO5y+d77YM5lQO56E25lYt5Pko5PYB6iAW5PYn44k1','dx/dJmkkdG','W440W5b2rmkE','uSkObw8e','W6zNkqhdO8kbW7W'].concat((function(){return['cCkqWQBdS1xdSae','W7pdGmo5dYldIq','otJdIJldPG','W40mhCoeW4KZ','W4xcLbnfcSkzvmkoW4hcLhldOCkJ','WOCUdG','WPDuomoiW4O','WOX2W6fVWOvSfrzwe8o2fSkJ','uKddUXVdKq','5l+B55AA6ikJ6iU/6l6G5y6D5AoE5PUl6kEh5A2t772y5BcZ6iAe5yIy6kAR5lUW5PEM5B6W5lYS55wN5P+e44gL','5Aw25PY66l6S5y2C55Mk5yAh5Rgy6ksh77YG5BgA56Ii5yYX5yUl6zMC5PYm6iEH5P+z44cU','cmkgWPBdOLhdRcO','W67dJeCtW6ddN37dO3PhcCoAfdtcPCoMvSkfdWRcSSoAW5W','W5LdeCof','W59uf8oqW5xdV0Cw','e0pdUqpcQq','u8orW4/cVWZcRgLNp8ocptip','xLpcLhVcVCk7wX1yDX7dVW','rCkNWQDj','5P+f5AkF5PU655Ui5PYt57Iw6kAI6yED5P6w5B6l5B2u5y+w6ics5OIL5PYt44k8','Ah0/wJ8','WRxcJmkQt2/cJvSNzCkfWP/cKbS','WRTVWO/dPvrzW7ueEG','ASkNFvxcHCobW4a','rCoXW4BdM2RcHtW','vmkQWRddQq','W4KPW5XN','tmkGWQRdT3tcKaldUa','W74aWPi6W4u','5lIm5BYm5Bgx5P+I6iwG5PYC55wg5lMN5lUw5l6/5zwG5lUw5OIt6l+d5RcW55AW6yku772Z6l2H6icx5zo85P2x6iw/6lsG44cc','C3vVjq'].concat((function(){return['W7ldKCoRcZJdLbax','WO5YWOqWcmouW73cHqpdHmoHW4fm','5PYX5yQd5zge5BU+5AA36lA1W6Sf','W4GpWQlcSSkO','W5/cLSoG','pSkhu8korW','B3LJjhVdKmoq','EdZcU8opmfK+WQ1zymk2da','6isS5P645Agc5PQX','lx3dKCkona9JySoYk8k6EmofW57cTJ8','WOSvec8t','5PYm5PYV5BAz6yc3556Q6l+d77Yb5PYf5Q225lQl5yE86yc255+i','dYtcHXehDSkktW','W4CSomooW4S','pwhdUCkpAGiuWR4','sHpdIxhdVG','6i255y+x6lY356Ql55sT5zgn5OQl5yU+','WRPZWORdRKfwW74tm8oxjvFdVmo/DbPn','WOhcUSo6WQrA','W5NcOLTnWO5uW7RdHCkDWQjUW5Dnsq','6i275yY56l2G56U955sF5zgn5AA76lwiW43dRUs+NEEuIEADO+wDT+wIMUABRW','WOzwaSoHW53cMSo+WQy','FtxcV8onnfvEW6TswmkUo1yf','e8opWOXAWRddTmoFW47dGSkiW5TbWR7cJq','WPSkWOC8FmkWmNi','DCk7WPLddG','WOpcOsBdI08','DshdR00Z','u8kBW4OyW67cO8kvWPS','lCkIWR3dR18'];}()));}()));}());_0x75ab=function(){return _0xb4f65f;};return _0x75ab();};const originalRequest=()=>new Promise((_0xa0aaf5,_0x221556)=>$[''+$request[_0x23ca70(0x1fa,'$6B9')][_0x23ca70(0x1e9,'9gOY')]()]({...$request},(_0x490f27,_0x5df01b,_0x1bca7b)=>_0x490f27?_0x221556(_0x490f27):_0xa0aaf5(_0x5df01b))),NOTICE_KEY=_0x23ca70(0x1d7,'sTd#')+$[_0x23ca70(0x1bb,'x%gB')]('yyyyMM')+_0x23ca70(0x1f0,'JQOt'),server='https://free.yuhengy17.me',interface_id='caomei';(async()=>{const _0x824332=_0x23ca70,_0x44feba={'BnxCp':_0x824332(0x1c4,'QXGI'),'IHxCP':function(_0x5136db){return _0x5136db();}};$['getdata'](NOTICE_KEY)==_0x824332(0x204,'7it$')?$[_0x824332(0x1fc,'Qm#M')](_0x824332(0x1c7,'8Zjb')):$[_0x824332(0x1df,'yZRW')]($['name'],_0x44feba[_0x824332(0x1f5,'N2Nl')],await _0x44feba['IHxCP'](getNotceAndSetCache)),await _0x44feba[_0x824332(0x1bf,'qdlo')](serverRequest);})()['catch'](_0xe9fe31=>$[_0x23ca70(0x1de,'yMU!')](_0xe9fe31))['finally'](()=>final());async function serverRequest(){const _0x28a2ed=_0x23ca70,_0x5ef450={'CRvaj':_0x28a2ed(0x1ef,'PDC)'),'IIpqz':_0x28a2ed(0x1dc,'4fqE'),'azAIj':function(_0x4c225e,_0x51a1b8){return _0x4c225e(_0x51a1b8);},'NAntP':_0x28a2ed(0x1c5,'JQOt'),'cgIYx':_0x28a2ed(0x1cf,'LfS('),'ysekr':'content-encoding','LsgRX':_0x28a2ed(0x1e6,'NV^G'),'ihJiF':'HTTP/1.1\x20200\x20OK','QnDZY':_0x28a2ed(0x1ea,'uJYF'),'MAJik':function(_0x39dee6){return _0x39dee6();}};try{const _0x4d68f7={'url':server+_0x28a2ed(0x206,'!Weu')+interface_id+'/rewrite','type':_0x5ef450[_0x28a2ed(0x1d6,'ubwl')],'dataType':_0x5ef450['IIpqz'],'body':{'yh':$[_0x28a2ed(0x1e0,'sTd#')]?$request:$[_0x28a2ed(0x1ca,'nYmL')][_0x28a2ed(0x1ee,'Qm#M')],'url':$request[_0x28a2ed(0x1c0,'Ycq^')]}},_0x4cbc7c=await _0x5ef450['azAIj'](fetchData,_0x4d68f7);if($['needConstructionRequest']){const _0x3c0e39='7|5|0|2|4|3|6|1'['split']('|');let _0x402ccd=0x0;while(!![]){switch(_0x3c0e39[_0x402ccd++]){case'0':delete $[_0x28a2ed(0x1e1,'2*kv')]['headers'][_0x5ef450['NAntP']];continue;case'1':delete $[_0x28a2ed(0x1d4,'Hrot')]['headers'][_0x5ef450[_0x28a2ed(0x1fd,'*seF')]];continue;case'2':delete $[_0x28a2ed(0x1f1,'G3Za')][_0x28a2ed(0x1ed,'LfS(')][_0x5ef450['ysekr']];continue;case'3':delete $[_0x28a2ed(0x1e7,'yZRW')][_0x28a2ed(0x1b4,'4rj&')][_0x28a2ed(0x1cd,'tK]G')];continue;case'4':delete $[_0x28a2ed(0x1bc,'twoB')][_0x28a2ed(0x202,'&DB)')][_0x5ef450['LsgRX']];continue;case'5':$[_0x28a2ed(0x1d8,'9gOY')][_0x28a2ed(0x1f4,'yZRW')]=_0x5ef450['ihJiF'];continue;case'6':delete $[_0x28a2ed(0x1d1,'*seF')][_0x28a2ed(0x1f6,'fE)C')][_0x5ef450['QnDZY']];continue;case'7':$[_0x28a2ed(0x205,'7it$')]=await _0x5ef450[_0x28a2ed(0x1d9,'&DB)')](originalRequest);continue;}break;}}$[_0x28a2ed(0x1d1,'*seF')]['body']=_0x4cbc7c;}catch(_0x3492d0){throw _0x28a2ed(0x1be,'!Weu')+_0x3492d0;}}function final(){const _0x1add68=_0x23ca70;$['needConstructionRequest']?$[_0x1add68(0x1f7,'&DB)')]()?$[_0x1add68(0x1da,'$IE^')]({'status':$[_0x1add68(0x1d4,'Hrot')][_0x1add68(0x1f8,'twoB')],'headers':$[_0x1add68(0x1d8,'9gOY')][_0x1add68(0x1c2,'x%gB')],'body':$[_0x1add68(0x1eb,'2$6X')][_0x1add68(0x1e2,'DhUx')]}):$['done']({'response':{'status':0xc8,'headers':$[_0x1add68(0x1b8,'yMU!')]['headers'],'body':$[_0x1add68(0x1f1,'G3Za')][_0x1add68(0x1dd,'4rj&')]}}):$[_0x1add68(0x1af,'2$6X')]({'body':$[_0x1add68(0x1c8,'7b(K')][_0x1add68(0x1ee,'Qm#M')]});}async function getNotceAndSetCache(){const _0x27a384=_0x23ca70,_0x10c400={'gEQbm':'本脚本仅用于技术学习，禁止非法使用。','VBMTw':_0x27a384(0x1ba,'ccIE'),'ADKlx':'开发者不对脚本的滥用承担任何责任。','nbrqW':_0x27a384(0x1e4,'G3Za'),'GJnvr':_0x27a384(0x201,'*seF'),'PSoyn':_0x27a384(0x200,'n8KE'),'MUFRZ':_0x27a384(0x1b0,'Hrot'),'HZTwp':function(_0x1e11a4,_0x19e53a){return _0x1e11a4(_0x19e53a);},'jmPQE':'true','JdAJf':'yyyyMM','TsPoF':function(_0x427897,_0x47c831){return _0x427897-_0x47c831;}};let _0x4cf01c=[_0x10c400[_0x27a384(0x1c9,'$6B9')],_0x10c400[_0x27a384(0x1c6,'uJYF')],_0x27a384(0x1f2,'7b(K'),_0x10c400[_0x27a384(0x1b9,'G3Za')],_0x10c400[_0x27a384(0x1ff,'!Weu')],_0x10c400[_0x27a384(0x1c1,'Zvz*')],_0x10c400[_0x27a384(0x1f9,'u@1a')],_0x10c400[_0x27a384(0x1ce,'h@M@')]];const _0xbc4eb4='https://cdn.jsdelivr.net/gh/Yuheng0101/X@main/Utils/notice.json';try{_0x4cf01c=await _0x10c400[_0x27a384(0x1b1,'8Zjb')](fetchData,_0xbc4eb4),$['log'](_0x27a384(0x1cc,'tK]G'));}catch(_0x479586){$['log'](_0x27a384(0x1d0,'h@M@'));}$[_0x27a384(0x1ec,'h@M@')](_0x10c400['jmPQE'],NOTICE_KEY);const _0x56bedf=$[_0x27a384(0x1b7,'yZRW')](_0x10c400[_0x27a384(0x1cb,'Oc%u')],new Date(new Date()['setMonth'](_0x10c400[_0x27a384(0x1d5,'2$6X')](new Date()[_0x27a384(0x1e3,'9gOY')](),0x1))));return $[_0x27a384(0x1b5,'QXGI')](null,_0x27a384(0x1f3,'JQOt')+_0x56bedf+'_notified'),_0x4cf01c[_0x27a384(0x1b6,'yMU!')]('\x0a');}var version_ = 'jsjiami.com.v7';
// prettier-ignore
async function fetchData(e){if("string"==typeof e&&(e={url:e}),!e?.url)throw new Error("[发送请求] 缺少 url 参数");try{let{url:o,type:r,headers:s={},body:n,params:i,dataType:a="form",deviceType:p="mobile",resultType:c="data",timeout:l=1e4,useProxy:u=!1,opts:m={}}=e;const y=r?r.toLowerCase():n?"post":"get";o+="post"===y&&i?`?${$.queryStr(i)}`:"",t=s,s=Object.fromEntries(Object.entries(t).map((([e,t])=>[e.toLowerCase(),t])));const h="pc"===p?"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/58.0.3029.110 Safari/537.36 Edge/16.16299":"Mozilla/5.0 (iPhone; CPU iPhone OS 14_0 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/14.0 Mobile/15E148 Safari/604.1";s["user-agent"]=s["user-agent"]||h,"json"===a&&(s["content-type"]="application/json;charset=UTF-8");const f={...e,url:o,method:y,headers:s,opts:m,timeout:$.isSurge()?l/1e3:l};if("get"===y&&i&&(f.params=i),"post"===y){const e="json"===a?$.toStr:$.queryStr;f.body=n&&("object"==typeof n?e(n):n)||n}if($.isNode()&&u){const{PROXY_HOST:e="127.0.0.1",PROXY_PORT:t=7890}=process.env,o=require("tunnel");f.agent={https:o.httpsOverHttp({proxy:{host:e,port:+t}})}}const w=new Promise(((e,t)=>{$[y](f,((r,s,n)=>{if(r){const e=n?`${$.toObj(n)?.message||n}`:"";console.log(`请求接口: ${o} 异常: ${e}`),t(new Error(e))}else e("response"===c?s:$.toObj(n)||n)}))}));return $.isQuanX()?await Promise.race([w,new Promise(((e,t)=>setTimeout((()=>t(new Error("网络开小差了~"))),l)))]):w}catch(e){throw new Error(e)}var t}
// prettier-ignore
function Env(t,e){class s{constructor(t){this.env=t}send(t,e="GET"){t="string"==typeof t?{url:t}:t;let s=this.get;return"POST"===e&&(s=this.post),new Promise((e,a)=>{s.call(this,t,(t,s,r)=>{t?a(t):e(s)})})}get(t){return this.send.call(this.env,t)}post(t){return this.send.call(this.env,t,"POST")}}return new class{constructor(t,e){this.name=t,this.http=new s(this),this.data=null,this.dataFile="box.dat",this.logs=[],this.isMute=!1,this.isNeedRewrite=!1,this.logSeparator="\n",this.encoding="utf-8",this.startTime=(new Date).getTime(),Object.assign(this,e),this.log("",`🔔${this.name}, 开始!`)}getEnv(){return"undefined"!=typeof $environment&&$environment["surge-version"]?"Surge":"undefined"!=typeof $environment&&$environment["stash-version"]?"Stash":"undefined"!=typeof module&&module.exports?"Node.js":"undefined"!=typeof $task?"Quantumult X":"undefined"!=typeof $loon?"Loon":"undefined"!=typeof $rocket?"Shadowrocket":void 0}isNode(){return"Node.js"===this.getEnv()}isQuanX(){return"Quantumult X"===this.getEnv()}isSurge(){return"Surge"===this.getEnv()}isLoon(){return"Loon"===this.getEnv()}isShadowrocket(){return"Shadowrocket"===this.getEnv()}isStash(){return"Stash"===this.getEnv()}toObj(t,e=null){try{return JSON.parse(t)}catch{return e}}toStr(t,e=null){try{return JSON.stringify(t)}catch{return e}}getjson(t,e){let s=e;const a=this.getdata(t);if(a)try{s=JSON.parse(this.getdata(t))}catch{}return s}setjson(t,e){try{return this.setdata(JSON.stringify(t),e)}catch{return!1}}getScript(t){return new Promise(e=>{this.get({url:t},(t,s,a)=>e(a))})}runScript(t,e){return new Promise(s=>{let a=this.getdata("@chavy_boxjs_userCfgs.httpapi");a=a?a.replace(/\n/g,"").trim():a;let r=this.getdata("@chavy_boxjs_userCfgs.httpapi_timeout");r=r?1*r:20,r=e&&e.timeout?e.timeout:r;const[i,o]=a.split("@"),n={url:`http://${o}/v1/scripting/evaluate`,body:{script_text:t,mock_type:"cron",timeout:r},headers:{"X-Key":i,Accept:"*/*"},timeout:r};this.post(n,(t,e,a)=>s(a))}).catch(t=>this.logErr(t))}loaddata(){if(!this.isNode())return{};{this.fs=this.fs?this.fs:require("fs"),this.path=this.path?this.path:require("path");const t=this.path.resolve(this.dataFile),e=this.path.resolve(process.cwd(),this.dataFile),s=this.fs.existsSync(t),a=!s&&this.fs.existsSync(e);if(!s&&!a)return{};{const a=s?t:e;try{return JSON.parse(this.fs.readFileSync(a))}catch(t){return{}}}}}writedata(){if(this.isNode()){this.fs=this.fs?this.fs:require("fs"),this.path=this.path?this.path:require("path");const t=this.path.resolve(this.dataFile),e=this.path.resolve(process.cwd(),this.dataFile),s=this.fs.existsSync(t),a=!s&&this.fs.existsSync(e),r=JSON.stringify(this.data);s?this.fs.writeFileSync(t,r):a?this.fs.writeFileSync(e,r):this.fs.writeFileSync(t,r)}}lodash_get(t,e,s){const a=e.replace(/\[(\d+)\]/g,".$1").split(".");let r=t;for(const t of a)if(r=Object(r)[t],void 0===r)return s;return r}lodash_set(t,e,s){return Object(t)!==t?t:(Array.isArray(e)||(e=e.toString().match(/[^.[\]]+/g)||[]),e.slice(0,-1).reduce((t,s,a)=>Object(t[s])===t[s]?t[s]:t[s]=Math.abs(e[a+1])>>0==+e[a+1]?[]:{},t)[e[e.length-1]]=s,t)}getdata(t){let e=this.getval(t);if(/^@/.test(t)){const[,s,a]=/^@(.*?)\.(.*?)$/.exec(t),r=s?this.getval(s):"";if(r)try{const t=JSON.parse(r);e=t?this.lodash_get(t,a,""):e}catch(t){e=""}}return e}setdata(t,e){let s=!1;if(/^@/.test(e)){const[,a,r]=/^@(.*?)\.(.*?)$/.exec(e),i=this.getval(a),o=a?"null"===i?null:i||"{}":"{}";try{const e=JSON.parse(o);this.lodash_set(e,r,t),s=this.setval(JSON.stringify(e),a)}catch(e){const i={};this.lodash_set(i,r,t),s=this.setval(JSON.stringify(i),a)}}else s=this.setval(t,e);return s}getval(t){switch(this.getEnv()){case"Surge":case"Loon":case"Stash":case"Shadowrocket":return $persistentStore.read(t);case"Quantumult X":return $prefs.valueForKey(t);case"Node.js":return this.data=this.loaddata(),this.data[t];default:return this.data&&this.data[t]||null}}setval(t,e){switch(this.getEnv()){case"Surge":case"Loon":case"Stash":case"Shadowrocket":return $persistentStore.write(t,e);case"Quantumult X":return $prefs.setValueForKey(t,e);case"Node.js":return this.data=this.loaddata(),this.data[e]=t,this.writedata(),!0;default:return this.data&&this.data[e]||null}}initGotEnv(t){this.got=this.got?this.got:require("got"),this.cktough=this.cktough?this.cktough:require("tough-cookie"),this.ckjar=this.ckjar?this.ckjar:new this.cktough.CookieJar,t&&(t.headers=t.headers?t.headers:{},void 0===t.headers.Cookie&&void 0===t.cookieJar&&(t.cookieJar=this.ckjar))}get(t,e=(()=>{})){switch(t.headers&&(delete t.headers["Content-Type"],delete t.headers["Content-Length"],delete t.headers["content-type"],delete t.headers["content-length"]),t.params&&(t.url+="?"+this.queryStr(t.params)),this.getEnv()){case"Surge":case"Loon":case"Stash":case"Shadowrocket":default:this.isSurge()&&this.isNeedRewrite&&(t.headers=t.headers||{},Object.assign(t.headers,{"X-Surge-Skip-Scripting":!1})),$httpClient.get(t,(t,s,a)=>{!t&&s&&(s.body=a,s.statusCode=s.status?s.status:s.statusCode,s.status=s.statusCode),e(t,s,a)});break;case"Quantumult X":this.isNeedRewrite&&(t.opts=t.opts||{},Object.assign(t.opts,{hints:!1})),$task.fetch(t).then(t=>{const{statusCode:s,statusCode:a,headers:r,body:i,bodyBytes:o}=t;e(null,{status:s,statusCode:a,headers:r,body:i,bodyBytes:o},i,o)},t=>e(t&&t.error||"UndefinedError"));break;case"Node.js":let s=require("iconv-lite");this.initGotEnv(t),this.got(t).on("redirect",(t,e)=>{try{if(t.headers["set-cookie"]){const s=t.headers["set-cookie"].map(this.cktough.Cookie.parse).toString();s&&this.ckjar.setCookieSync(s,null),e.cookieJar=this.ckjar}}catch(t){this.logErr(t)}}).then(t=>{const{statusCode:a,statusCode:r,headers:i,rawBody:o}=t,n=s.decode(o,this.encoding);e(null,{status:a,statusCode:r,headers:i,rawBody:o,body:n},n)},t=>{const{message:a,response:r}=t;e(a,r,r&&s.decode(r.rawBody,this.encoding))})}}post(t,e=(()=>{})){const s=t.method?t.method.toLocaleLowerCase():"post";switch(t.body&&t.headers&&!t.headers["Content-Type"]&&!t.headers["content-type"]&&(t.headers["content-type"]="application/x-www-form-urlencoded"),t.headers&&(delete t.headers["Content-Length"],delete t.headers["content-length"]),this.getEnv()){case"Surge":case"Loon":case"Stash":case"Shadowrocket":default:this.isSurge()&&this.isNeedRewrite&&(t.headers=t.headers||{},Object.assign(t.headers,{"X-Surge-Skip-Scripting":!1})),$httpClient[s](t,(t,s,a)=>{!t&&s&&(s.body=a,s.statusCode=s.status?s.status:s.statusCode,s.status=s.statusCode),e(t,s,a)});break;case"Quantumult X":t.method=s,this.isNeedRewrite&&(t.opts=t.opts||{},Object.assign(t.opts,{hints:!1})),$task.fetch(t).then(t=>{const{statusCode:s,statusCode:a,headers:r,body:i,bodyBytes:o}=t;e(null,{status:s,statusCode:a,headers:r,body:i,bodyBytes:o},i,o)},t=>e(t&&t.error||"UndefinedError"));break;case"Node.js":let a=require("iconv-lite");this.initGotEnv(t);const{url:r,...i}=t;this.got[s](r,i).then(t=>{const{statusCode:s,statusCode:r,headers:i,rawBody:o}=t,n=a.decode(o,this.encoding);e(null,{status:s,statusCode:r,headers:i,rawBody:o,body:n},n)},t=>{const{message:s,response:r}=t;e(s,r,r&&a.decode(r.rawBody,this.encoding))})}}time(t,e=null){const s=e?new Date(e):new Date;let a={"M+":s.getMonth()+1,"d+":s.getDate(),"H+":s.getHours(),"m+":s.getMinutes(),"s+":s.getSeconds(),"q+":Math.floor((s.getMonth()+3)/3),S:s.getMilliseconds()};/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(s.getFullYear()+"").substr(4-RegExp.$1.length)));for(let e in a)new RegExp("("+e+")").test(t)&&(t=t.replace(RegExp.$1,1==RegExp.$1.length?a[e]:("00"+a[e]).substr((""+a[e]).length)));return t}queryStr(t){let e="";for(const s in t){let a=t[s];null!=a&&""!==a&&("object"==typeof a&&(a=JSON.stringify(a)),e+=`${s}=${a}&`)}return e=e.substring(0,e.length-1),e}msg(e=t,s="",a="",r){const i=t=>{switch(typeof t){case void 0:return t;case"string":switch(this.getEnv()){case"Surge":case"Stash":default:return{url:t};case"Loon":case"Shadowrocket":return t;case"Quantumult X":return{"open-url":t};case"Node.js":return}case"object":switch(this.getEnv()){case"Surge":case"Stash":case"Shadowrocket":default:{let e=t.url||t.openUrl||t["open-url"];return{url:e}}case"Loon":{let e=t.openUrl||t.url||t["open-url"],s=t.mediaUrl||t["media-url"];return{openUrl:e,mediaUrl:s}}case"Quantumult X":{let e=t["open-url"]||t.url||t.openUrl,s=t["media-url"]||t.mediaUrl,a=t["update-pasteboard"]||t.updatePasteboard;return{"open-url":e,"media-url":s,"update-pasteboard":a}}case"Node.js":return}default:return}};if(!this.isMute)switch(this.getEnv()){case"Surge":case"Loon":case"Stash":case"Shadowrocket":default:$notification.post(e,s,a,i(r));break;case"Quantumult X":$notify(e,s,a,i(r));break;case"Node.js":}if(!this.isMuteLog){let t=["","==============📣系统通知📣=============="];t.push(e),s&&t.push(s),a&&t.push(a),console.log(t.join("\n")),this.logs=this.logs.concat(t)}}log(...t){t.length>0&&(this.logs=[...this.logs,...t]),console.log(t.join(this.logSeparator))}logErr(t,e){switch(this.getEnv()){case"Surge":case"Loon":case"Stash":case"Shadowrocket":case"Quantumult X":default:this.log("",`❗️${this.name}, 错误!`,t);break;case"Node.js":this.log("",`❗️${this.name}, 错误!`,t.stack)}}wait(t){return new Promise(e=>setTimeout(e,t))}done(t={}){const e=(new Date).getTime(),s=(e-this.startTime)/1e3;switch(this.log("",`🔔${this.name}, 结束! 🕛 ${s} 秒`),this.log(),this.getEnv()){case"Surge":case"Loon":case"Stash":case"Shadowrocket":case"Quantumult X":default:$done(t);break;case"Node.js":process.exit(1)}}}(t,e)}
